[2025-07-21 21:46:11] REQUEST recibido: Array
(
    [action] => obtener_planteles
)

[2025-07-21 21:46:11] Query planteles: SELECT id_pla, nom_pla, fec_pla FROM plantel ORDER BY nom_pla ASC
[2025-07-21 21:46:11] Planteles encontrados: 3
[2025-07-21 21:46:11] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:46:11] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:46:11] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:46:11] REQUEST recibido: Array
(
    [action] => obtener_ejecutivos_con_citas
)

[2025-07-21 21:46:11] Query ejecutivos con citas: SELECT e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje,
					         p.nom_pla as plantel_principal,
					         COUNT(DISTINCT c.id_cit) as citas_propias,
					         GROUP_CONCAT(DISTINCT CONCAT(pa.id_pla, ':', pa.nom_pla) SEPARATOR '|') as planteles_asociados,
					         COUNT(DISTINCT pe.id_pla) as total_planteles_asociados,
					         CASE 
					             WHEN e.ult_eje IS NULL THEN 'sin_sesion'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) <= 1 THEN 'verde'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) BETWEEN 2 AND 3 THEN 'amarillo'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) >= 4 THEN 'rojo'
					             ELSE 'sin_sesion'
					         END as semaforo_sesion,
					         TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) as dias_desde_ultima_sesion
					  FROM ejecutivo e 
					  LEFT JOIN plantel p ON e.id_pla = p.id_pla 
					  LEFT JOIN cita c ON e.id_eje = c.id_eje2 AND c.eli_cit = 1 
					  LEFT JOIN planteles_ejecutivo pe ON e.id_eje = pe.id_eje
					  LEFT JOIN plantel pa ON pe.id_pla = pa.id_pla
					  GROUP BY e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje, p.nom_pla
					  ORDER BY e.eli_eje DESC, e.nom_eje ASC
[2025-07-21 21:46:11] Ejecutivo ID: 9 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:46:11] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:46:11] Ejecutivo ID: 16 - Citas propias: 6 - Citas hijos: 6 - Total: 12
[2025-07-21 21:46:11] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:46:11] Ejecutivo ID: 13 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:46:11] Ejecutivo ID: 12 - Citas propias: 5 - Citas hijos: 4 - Total: 9
[2025-07-21 21:46:11] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:46:11] Ejecutivo ID: 15 - Citas propias: 7 - Citas hijos: 2 - Total: 9
[2025-07-21 21:46:11] Ejecutivo ID: 18 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:46:11] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:46:11] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:46:11] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:46:11] Ejecutivo ID: 10 - Citas propias: 3 - Citas hijos: 3 - Total: 6
[2025-07-21 21:46:11] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:46:11] Ejecutivo ID: 2 - Citas propias: 4 - Citas hijos: 5 - Total: 9
[2025-07-21 21:46:11] Ejecutivo ID: 14 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:46:11] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:46:11] Ejecutivo ID: 20 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:46:11] Ejecutivo ID: 13 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:46:11] Ejecutivo ID: 1 - Citas propias: 0 - Citas hijos: 0 - Total: 0
[2025-07-21 21:46:11] Ejecutivos con citas encontrados: 15
[2025-07-21 21:46:11] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:46:11] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:46:11] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:46:18] REQUEST recibido: Array
(
    [action] => mover_ejecutivo
    [id_eje] => 18
    [id_padre] => 
    [id_pla] => 6
)

[2025-07-21 21:46:18] ==============================================
[2025-07-21 21:46:18] MOVER EJECUTIVO - REQUEST RECIBIDO
[2025-07-21 21:46:18] POST data completo: Array
(
    [action] => mover_ejecutivo
    [id_eje] => 18
    [id_padre] => 
    [id_pla] => 6
)

[2025-07-21 21:46:18] Valores procesados:
[2025-07-21 21:46:18] - ID Ejecutivo: 18
[2025-07-21 21:46:18] - ID Padre: NULL
[2025-07-21 21:46:18] - ID Plantel: 6
[2025-07-21 21:46:18] ANTES - Ejecutivo: Eric Valenzuela, Padre anterior: , Plantel anterior: 3
[2025-07-21 21:46:18] NUEVO PLANTEL: Plantel Cuautitlán (ID: 6)
[2025-07-21 21:46:18] QUERY MOVER: UPDATE ejecutivo SET id_padre = NULL, id_pla = '6' WHERE id_eje = '18'
[2025-07-21 21:46:18] VERIFICACIÓN - Nuevo padre: , Nuevo plantel: 6
[2025-07-21 21:46:18] WebSocket cambio plantel enviado
[2025-07-21 21:46:18] EJECUTIVO MOVIDO EXITOSAMENTE
[2025-07-21 21:46:18] RESPUESTA ENVIADA: SUCCESS
[2025-07-21 21:46:18] ==============================================
[2025-07-21 21:46:19] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:46:19] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:46:19] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:46:40] REQUEST recibido: Array
(
    [action] => mover_ejecutivo
    [id_eje] => 13
    [id_padre] => 
    [id_pla] => 6
)

[2025-07-21 21:46:40] ==============================================
[2025-07-21 21:46:40] MOVER EJECUTIVO - REQUEST RECIBIDO
[2025-07-21 21:46:40] POST data completo: Array
(
    [action] => mover_ejecutivo
    [id_eje] => 13
    [id_padre] => 
    [id_pla] => 6
)

[2025-07-21 21:46:40] Valores procesados:
[2025-07-21 21:46:40] - ID Ejecutivo: 13
[2025-07-21 21:46:40] - ID Padre: NULL
[2025-07-21 21:46:40] - ID Plantel: 6
[2025-07-21 21:46:40] ANTES - Ejecutivo: Sofia Mendoza, Padre anterior: 12, Plantel anterior: 3
[2025-07-21 21:46:40] NUEVO PLANTEL: Plantel Cuautitlán (ID: 6)
[2025-07-21 21:46:40] QUERY MOVER: UPDATE ejecutivo SET id_padre = NULL, id_pla = '6' WHERE id_eje = '13'
[2025-07-21 21:46:40] VERIFICACIÓN - Nuevo padre: , Nuevo plantel: 6
[2025-07-21 21:46:40] WebSocket movimiento enviado
[2025-07-21 21:46:40] WebSocket cambio plantel enviado
[2025-07-21 21:46:40] EJECUTIVO MOVIDO EXITOSAMENTE
[2025-07-21 21:46:40] RESPUESTA ENVIADA: SUCCESS
[2025-07-21 21:46:40] ==============================================
[2025-07-21 21:46:40] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:46:40] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:46:40] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:48:40] REQUEST recibido: Array
(
    [action] => obtener_planteles
)

[2025-07-21 21:48:40] Query planteles: SELECT id_pla, nom_pla, fec_pla FROM plantel ORDER BY nom_pla ASC
[2025-07-21 21:48:40] Planteles encontrados: 3
[2025-07-21 21:48:40] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:48:40] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:48:40] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:48:40] REQUEST recibido: Array
(
    [action] => obtener_ejecutivos_con_citas
)

[2025-07-21 21:48:40] Query ejecutivos con citas: SELECT e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje,
					         p.nom_pla as plantel_principal,
					         COUNT(DISTINCT c.id_cit) as citas_propias,
					         GROUP_CONCAT(DISTINCT CONCAT(pa.id_pla, ':', pa.nom_pla) SEPARATOR '|') as planteles_asociados,
					         COUNT(DISTINCT pe.id_pla) as total_planteles_asociados,
					         CASE 
					             WHEN e.ult_eje IS NULL THEN 'sin_sesion'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) <= 1 THEN 'verde'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) BETWEEN 2 AND 3 THEN 'amarillo'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) >= 4 THEN 'rojo'
					             ELSE 'sin_sesion'
					         END as semaforo_sesion,
					         TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) as dias_desde_ultima_sesion
					  FROM ejecutivo e 
					  LEFT JOIN plantel p ON e.id_pla = p.id_pla 
					  LEFT JOIN cita c ON e.id_eje = c.id_eje2 AND c.eli_cit = 1 
					  LEFT JOIN planteles_ejecutivo pe ON e.id_eje = pe.id_eje
					  LEFT JOIN plantel pa ON pe.id_pla = pa.id_pla
					  GROUP BY e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje, p.nom_pla
					  ORDER BY e.eli_eje DESC, e.nom_eje ASC
[2025-07-21 21:48:40] Ejecutivo ID: 9 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:48:40] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:48:40] Ejecutivo ID: 16 - Citas propias: 6 - Citas hijos: 6 - Total: 12
[2025-07-21 21:48:40] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:48:40] Ejecutivo ID: 12 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:48:40] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:48:40] Ejecutivo ID: 15 - Citas propias: 7 - Citas hijos: 2 - Total: 9
[2025-07-21 21:48:40] Ejecutivo ID: 18 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:48:40] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:48:40] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:48:40] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:48:40] Ejecutivo ID: 10 - Citas propias: 3 - Citas hijos: 3 - Total: 6
[2025-07-21 21:48:40] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:48:40] Ejecutivo ID: 2 - Citas propias: 4 - Citas hijos: 5 - Total: 9
[2025-07-21 21:48:40] Ejecutivo ID: 14 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:48:40] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:48:40] Ejecutivo ID: 20 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:48:40] Ejecutivo ID: 13 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:48:40] Ejecutivo ID: 1 - Citas propias: 0 - Citas hijos: 0 - Total: 0
[2025-07-21 21:48:40] Ejecutivos con citas encontrados: 15
[2025-07-21 21:48:40] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:48:40] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:49:14] REQUEST recibido: Array
(
    [action] => obtener_planteles
)

[2025-07-21 21:49:14] Query planteles: SELECT id_pla, nom_pla, fec_pla FROM plantel ORDER BY nom_pla ASC
[2025-07-21 21:49:14] Planteles encontrados: 3
[2025-07-21 21:49:14] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:49:14] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:49:14] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:49:14] REQUEST recibido: Array
(
    [action] => obtener_ejecutivos_con_citas
)

[2025-07-21 21:49:14] Query ejecutivos con citas: SELECT e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje,
					         p.nom_pla as plantel_principal,
					         COUNT(DISTINCT c.id_cit) as citas_propias,
					         GROUP_CONCAT(DISTINCT CONCAT(pa.id_pla, ':', pa.nom_pla) SEPARATOR '|') as planteles_asociados,
					         COUNT(DISTINCT pe.id_pla) as total_planteles_asociados,
					         CASE 
					             WHEN e.ult_eje IS NULL THEN 'sin_sesion'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) <= 1 THEN 'verde'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) BETWEEN 2 AND 3 THEN 'amarillo'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) >= 4 THEN 'rojo'
					             ELSE 'sin_sesion'
					         END as semaforo_sesion,
					         TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) as dias_desde_ultima_sesion
					  FROM ejecutivo e 
					  LEFT JOIN plantel p ON e.id_pla = p.id_pla 
					  LEFT JOIN cita c ON e.id_eje = c.id_eje2 AND c.eli_cit = 1 
					  LEFT JOIN planteles_ejecutivo pe ON e.id_eje = pe.id_eje
					  LEFT JOIN plantel pa ON pe.id_pla = pa.id_pla
					  GROUP BY e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje, p.nom_pla
					  ORDER BY e.eli_eje DESC, e.nom_eje ASC
[2025-07-21 21:49:14] Ejecutivo ID: 9 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:49:14] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:49:14] Ejecutivo ID: 16 - Citas propias: 6 - Citas hijos: 6 - Total: 12
[2025-07-21 21:49:14] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:49:14] Ejecutivo ID: 12 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:14] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:49:14] Ejecutivo ID: 15 - Citas propias: 7 - Citas hijos: 2 - Total: 9
[2025-07-21 21:49:14] Ejecutivo ID: 18 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:14] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:49:14] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:49:14] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:49:14] Ejecutivo ID: 10 - Citas propias: 3 - Citas hijos: 3 - Total: 6
[2025-07-21 21:49:14] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:14] Ejecutivo ID: 2 - Citas propias: 4 - Citas hijos: 5 - Total: 9
[2025-07-21 21:49:14] Ejecutivo ID: 14 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:49:14] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:14] Ejecutivo ID: 20 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:14] Ejecutivo ID: 13 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:49:14] Ejecutivo ID: 1 - Citas propias: 0 - Citas hijos: 0 - Total: 0
[2025-07-21 21:49:14] Ejecutivos con citas encontrados: 15
[2025-07-21 21:49:14] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:49:14] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:49:20] REQUEST recibido: Array
(
    [action] => obtener_planteles
)

[2025-07-21 21:49:20] Query planteles: SELECT id_pla, nom_pla, fec_pla FROM plantel ORDER BY nom_pla ASC
[2025-07-21 21:49:20] Planteles encontrados: 3
[2025-07-21 21:49:20] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:49:20] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:49:20] REQUEST recibido: Array
(
    [action] => obtener_ejecutivos_con_citas
)

[2025-07-21 21:49:20] Query ejecutivos con citas: SELECT e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje,
					         p.nom_pla as plantel_principal,
					         COUNT(DISTINCT c.id_cit) as citas_propias,
					         GROUP_CONCAT(DISTINCT CONCAT(pa.id_pla, ':', pa.nom_pla) SEPARATOR '|') as planteles_asociados,
					         COUNT(DISTINCT pe.id_pla) as total_planteles_asociados,
					         CASE 
					             WHEN e.ult_eje IS NULL THEN 'sin_sesion'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) <= 1 THEN 'verde'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) BETWEEN 2 AND 3 THEN 'amarillo'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) >= 4 THEN 'rojo'
					             ELSE 'sin_sesion'
					         END as semaforo_sesion,
					         TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) as dias_desde_ultima_sesion
					  FROM ejecutivo e 
					  LEFT JOIN plantel p ON e.id_pla = p.id_pla 
					  LEFT JOIN cita c ON e.id_eje = c.id_eje2 AND c.eli_cit = 1 
					  LEFT JOIN planteles_ejecutivo pe ON e.id_eje = pe.id_eje
					  LEFT JOIN plantel pa ON pe.id_pla = pa.id_pla
					  GROUP BY e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje, p.nom_pla
					  ORDER BY e.eli_eje DESC, e.nom_eje ASC
[2025-07-21 21:49:20] Ejecutivo ID: 9 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:49:20] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:49:20] Ejecutivo ID: 16 - Citas propias: 6 - Citas hijos: 6 - Total: 12
[2025-07-21 21:49:20] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:49:20] Ejecutivo ID: 12 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:20] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:49:20] Ejecutivo ID: 15 - Citas propias: 7 - Citas hijos: 2 - Total: 9
[2025-07-21 21:49:20] Ejecutivo ID: 18 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:20] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:49:20] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:49:20] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:49:20] Ejecutivo ID: 10 - Citas propias: 3 - Citas hijos: 3 - Total: 6
[2025-07-21 21:49:20] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:20] Ejecutivo ID: 2 - Citas propias: 4 - Citas hijos: 5 - Total: 9
[2025-07-21 21:49:20] Ejecutivo ID: 14 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:49:20] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:20] Ejecutivo ID: 20 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:20] Ejecutivo ID: 13 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:49:20] Ejecutivo ID: 1 - Citas propias: 0 - Citas hijos: 0 - Total: 0
[2025-07-21 21:49:20] Ejecutivos con citas encontrados: 15
[2025-07-21 21:49:20] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:49:20] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:49:20] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:49:33] REQUEST recibido: Array
(
    [action] => obtener_planteles
)

[2025-07-21 21:49:33] Query planteles: SELECT id_pla, nom_pla, fec_pla FROM plantel ORDER BY nom_pla ASC
[2025-07-21 21:49:33] Planteles encontrados: 3
[2025-07-21 21:49:33] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:49:33] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:49:33] REQUEST recibido: Array
(
    [action] => obtener_ejecutivos_con_citas
)

[2025-07-21 21:49:33] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:49:33] Query ejecutivos con citas: SELECT e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje,
					         p.nom_pla as plantel_principal,
					         COUNT(DISTINCT c.id_cit) as citas_propias,
					         GROUP_CONCAT(DISTINCT CONCAT(pa.id_pla, ':', pa.nom_pla) SEPARATOR '|') as planteles_asociados,
					         COUNT(DISTINCT pe.id_pla) as total_planteles_asociados,
					         CASE 
					             WHEN e.ult_eje IS NULL THEN 'sin_sesion'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) <= 1 THEN 'verde'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) BETWEEN 2 AND 3 THEN 'amarillo'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) >= 4 THEN 'rojo'
					             ELSE 'sin_sesion'
					         END as semaforo_sesion,
					         TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) as dias_desde_ultima_sesion
					  FROM ejecutivo e 
					  LEFT JOIN plantel p ON e.id_pla = p.id_pla 
					  LEFT JOIN cita c ON e.id_eje = c.id_eje2 AND c.eli_cit = 1 
					  LEFT JOIN planteles_ejecutivo pe ON e.id_eje = pe.id_eje
					  LEFT JOIN plantel pa ON pe.id_pla = pa.id_pla
					  GROUP BY e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje, p.nom_pla
					  ORDER BY e.eli_eje DESC, e.nom_eje ASC
[2025-07-21 21:49:33] Ejecutivo ID: 9 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:49:33] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:49:33] Ejecutivo ID: 16 - Citas propias: 6 - Citas hijos: 6 - Total: 12
[2025-07-21 21:49:33] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:49:33] Ejecutivo ID: 12 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:33] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:49:33] Ejecutivo ID: 15 - Citas propias: 7 - Citas hijos: 2 - Total: 9
[2025-07-21 21:49:33] Ejecutivo ID: 18 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:33] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:49:33] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:49:33] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:49:33] Ejecutivo ID: 10 - Citas propias: 3 - Citas hijos: 3 - Total: 6
[2025-07-21 21:49:33] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:33] Ejecutivo ID: 2 - Citas propias: 4 - Citas hijos: 5 - Total: 9
[2025-07-21 21:49:33] Ejecutivo ID: 14 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:49:33] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:33] Ejecutivo ID: 20 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:49:33] Ejecutivo ID: 13 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:49:33] Ejecutivo ID: 1 - Citas propias: 0 - Citas hijos: 0 - Total: 0
[2025-07-21 21:49:33] Ejecutivos con citas encontrados: 15
[2025-07-21 21:49:33] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:49:33] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:49:33] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:52:18] REQUEST recibido: Array
(
    [action] => mover_ejecutivo
    [id_eje] => 4
    [id_padre] => 10
    [id_pla] => 6
)

[2025-07-21 21:52:18] ==============================================
[2025-07-21 21:52:18] MOVER EJECUTIVO - REQUEST RECIBIDO
[2025-07-21 21:52:18] POST data completo: Array
(
    [action] => mover_ejecutivo
    [id_eje] => 4
    [id_padre] => 10
    [id_pla] => 6
)

[2025-07-21 21:52:18] Valores procesados:
[2025-07-21 21:52:18] - ID Ejecutivo: 4
[2025-07-21 21:52:18] - ID Padre: 10
[2025-07-21 21:52:18] - ID Plantel: 6
[2025-07-21 21:52:18] ANTES - Ejecutivo: Francisco Pineda, Padre anterior: 10, Plantel anterior: 6
[2025-07-21 21:52:18] NUEVO PADRE: Luis Rodriguez (ID: 10)
[2025-07-21 21:52:18] NUEVO PLANTEL: Plantel Cuautitlán (ID: 6)
[2025-07-21 21:52:18] QUERY MOVER: UPDATE ejecutivo SET id_padre = '10', id_pla = '6' WHERE id_eje = '4'
[2025-07-21 21:52:18] VERIFICACIÓN - Nuevo padre: 10, Nuevo plantel: 6
[2025-07-21 21:52:18] EJECUTIVO MOVIDO EXITOSAMENTE
[2025-07-21 21:52:18] RESPUESTA ENVIADA: SUCCESS
[2025-07-21 21:52:18] ==============================================
[2025-07-21 21:52:18] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:52:18] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:52:18] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:57:14] REQUEST recibido: Array
(
    [action] => mover_ejecutivo
    [id_eje] => 12
    [id_padre] => 
    [id_pla] => 6
)

[2025-07-21 21:57:14] ==============================================
[2025-07-21 21:57:14] MOVER EJECUTIVO - REQUEST RECIBIDO
[2025-07-21 21:57:14] POST data completo: Array
(
    [action] => mover_ejecutivo
    [id_eje] => 12
    [id_padre] => 
    [id_pla] => 6
)

[2025-07-21 21:57:14] Valores procesados:
[2025-07-21 21:57:14] - ID Ejecutivo: 12
[2025-07-21 21:57:14] - ID Padre: NULL
[2025-07-21 21:57:14] - ID Plantel: 6
[2025-07-21 21:57:14] ANTES - Ejecutivo: Diego Herrera Luna, Padre anterior: , Plantel anterior: 3
[2025-07-21 21:57:14] NUEVO PLANTEL: Plantel Cuautitlán (ID: 6)
[2025-07-21 21:57:14] QUERY MOVER: UPDATE ejecutivo SET id_padre = NULL, id_pla = '6' WHERE id_eje = '12'
[2025-07-21 21:57:14] VERIFICACIÓN - Nuevo padre: , Nuevo plantel: 6
[2025-07-21 21:57:14] WebSocket cambio plantel enviado
[2025-07-21 21:57:14] EJECUTIVO MOVIDO EXITOSAMENTE
[2025-07-21 21:57:14] RESPUESTA ENVIADA: SUCCESS
[2025-07-21 21:57:14] ==============================================
[2025-07-21 21:57:14] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:57:14] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:57:14] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:57:46] REQUEST recibido: Array
(
    [action] => obtener_planteles
)

[2025-07-21 21:57:46] Query planteles: SELECT id_pla, nom_pla, fec_pla FROM plantel ORDER BY nom_pla ASC
[2025-07-21 21:57:46] Planteles encontrados: 3
[2025-07-21 21:57:46] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:57:46] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:57:46] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

[2025-07-21 21:57:46] REQUEST recibido: Array
(
    [action] => obtener_ejecutivos_con_citas
)

[2025-07-21 21:57:46] Query ejecutivos con citas: SELECT e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje,
					         p.nom_pla as plantel_principal,
					         COUNT(DISTINCT c.id_cit) as citas_propias,
					         GROUP_CONCAT(DISTINCT CONCAT(pa.id_pla, ':', pa.nom_pla) SEPARATOR '|') as planteles_asociados,
					         COUNT(DISTINCT pe.id_pla) as total_planteles_asociados,
					         CASE 
					             WHEN e.ult_eje IS NULL THEN 'sin_sesion'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) <= 1 THEN 'verde'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) BETWEEN 2 AND 3 THEN 'amarillo'
					             WHEN TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) >= 4 THEN 'rojo'
					             ELSE 'sin_sesion'
					         END as semaforo_sesion,
					         TIMESTAMPDIFF(DAY, e.ult_eje, NOW()) as dias_desde_ultima_sesion
					  FROM ejecutivo e 
					  LEFT JOIN plantel p ON e.id_pla = p.id_pla 
					  LEFT JOIN cita c ON e.id_eje = c.id_eje2 AND c.eli_cit = 1 
					  LEFT JOIN planteles_ejecutivo pe ON e.id_eje = pe.id_eje
					  LEFT JOIN plantel pa ON pe.id_pla = pa.id_pla
					  GROUP BY e.id_eje, e.nom_eje, e.tel_eje, e.eli_eje, e.id_padre, e.id_pla, e.ult_eje, p.nom_pla
					  ORDER BY e.eli_eje DESC, e.nom_eje ASC
[2025-07-21 21:57:46] Ejecutivo ID: 9 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:57:46] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:57:46] Ejecutivo ID: 16 - Citas propias: 6 - Citas hijos: 6 - Total: 12
[2025-07-21 21:57:46] Ejecutivo ID: 11 - Citas propias: 6 - Citas hijos: 0 - Total: 6
[2025-07-21 21:57:46] Ejecutivo ID: 12 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:57:46] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:57:46] Ejecutivo ID: 15 - Citas propias: 7 - Citas hijos: 2 - Total: 9
[2025-07-21 21:57:46] Ejecutivo ID: 18 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:57:46] Ejecutivo ID: 6 - Citas propias: 2 - Citas hijos: 0 - Total: 2
[2025-07-21 21:57:46] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:57:46] Ejecutivo ID: 4 - Citas propias: 3 - Citas hijos: 0 - Total: 3
[2025-07-21 21:57:46] Ejecutivo ID: 10 - Citas propias: 3 - Citas hijos: 3 - Total: 6
[2025-07-21 21:57:46] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:57:46] Ejecutivo ID: 2 - Citas propias: 4 - Citas hijos: 5 - Total: 9
[2025-07-21 21:57:46] Ejecutivo ID: 14 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:57:46] Ejecutivo ID: 21 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:57:46] Ejecutivo ID: 20 - Citas propias: 5 - Citas hijos: 0 - Total: 5
[2025-07-21 21:57:46] Ejecutivo ID: 13 - Citas propias: 4 - Citas hijos: 0 - Total: 4
[2025-07-21 21:57:46] Ejecutivo ID: 1 - Citas propias: 0 - Citas hijos: 0 - Total: 0
[2025-07-21 21:57:46] Ejecutivos con citas encontrados: 15
[2025-07-21 21:57:46] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 6
)

[2025-07-21 21:57:46] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 3
)

[2025-07-21 21:57:46] REQUEST recibido: Array
(
    [action] => obtener_citas_totales_por_plantel
    [id_pla] => 2
)

